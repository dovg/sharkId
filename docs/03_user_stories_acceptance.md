# User Stories (MVP)

---

## US-01 Авторизация

- Неавторизованный пользователь не имеет доступа ни к одной странице.
- Сессия ограничена по времени (JWT).
- При истечении токена пользователь перенаправляется на страницу входа.
- Ответ /auth/login содержит токен, роль и email пользователя.

---

## US-02 Локации

- Есть поиск по стране/споту.
- Можно добавить, отредактировать и удалить запись (editor+).
- Новая запись доступна сразу.
- Широта/долгота валидируются на сервере.
- Кнопки Add/Edit/Delete скрыты для viewer.

---

## US-03 Погружения

- Можно создать DiveSession (editor+).
- Фото и видео привязываются к погружению.
- На странице списка видны: дата, локация, количество акул, очередь валидации, превью акул.
- На странице детали: список акул, замеченных в этом погружении (с фото и ссылками).
- Кнопки Delete/Edit/Upload скрыты для viewer.

---

## US-04 Автоидентификация

- Запускается автоматически при загрузке фото или кадра из видео.
- Показывается топ-5 кандидатов с превью и процентом уверенности.
- Используется глобальный порог (ML_CONFIDENCE_THRESHOLD).
- Требуется подтверждение пользователем.

---

## US-05 Аннотация фото

- Доступна 3-шаговая ручная аннотация (editor+): bbox акулы → bbox зоны морды → ориентация.
- ML предзаполняет bbox автоматически (badge «ML pre-filled»).
- После ручной аннотации ML переклассифицирует фото.
- Для viewer аннотация отображается в режиме чтения без возможности редактирования.

---

## US-06 Новая акула

- Предлагается временное имя (персонаж Гарри Поттера).
- Можно изменить вручную.
- Имя может оставаться `temporary`.
- Можно установить фото профиля при создании.

---

## US-07 Наблюдение

- Черновик создаётся автоматически при валидации.
- Метаданные EXIF сохраняются полностью и доступны в сворачиваемой панели.
- Пользователь подтверждает или редактирует поля (editor+).
- Подтверждённое наблюдение нельзя изменить (API возвращает 409).
- Для viewer все поля read-only, кнопки Save/Confirm скрыты.

---

## US-08 Хранение фото

- Фото хранятся в MinIO, доступны по публичному URL через nginx.
- Поддерживаются JPEG и PNG, максимальный размер 50 МБ.
- Валидация формата (PIL.Image.verify) на сервере.

---

## US-09 Видео

- Поддерживаются MP4, MOV, AVI, MKV, WebM (макс. 500 МБ).
- Видео сохраняется в MinIO; ML извлекает кадры с акулами в фоновой задаче.
- Статус обработки отображается на странице погружения с автообновлением.
- Кнопка Delete скрыта для viewer.

---

## US-10 Ролевая модель

- 3 роли: viewer, editor, admin.
- API возвращает 403 при попытке выполнить действие без нужной роли.
- Соответствующие кнопки полностью скрыты в интерфейсе (не disabled, а отсутствуют в DOM).
- Sidebar показывает/скрывает пункты меню в зависимости от роли.

---

## US-11 Журнал событий (Audit Log)

- Все изменяющие действия фиксируются (логин, загрузка, валидация, создание/изменение/удаление).
- Доступен пользователям editor+ через страницу и через EventHistory-карточки на детальных страницах.
- Фильтрация по типу и ID ресурса.
- Пагинация (load more).

---

## US-12 Управление пользователями

- Администратор может создавать, редактировать (роль, пароль) и удалять пользователей.
- Администратор не может удалить свой собственный аккаунт (API возвращает 409).
- Страница /users доступна только admin; остальные перенаправляются на /sharks.

---

## US-13 Бэкап

- Регулярный бэкап БД.
- Регулярный бэкап MinIO.
- Есть процедура восстановления.
